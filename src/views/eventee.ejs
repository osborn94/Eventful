<div class="container py-5">

  <!-- SUCCESS ALERT -->
  <% if (query.reminder === "success") { %>
    <div class="alert alert-success shadow-sm">
      Reminder set successfully âœ…
    </div>
  <% } %>


  <!-- MY APPLICATIONS -->

  <div class="mb-5">
    <h2 class="fw-bold mb-3">My Applications</h2>
    <p class="text-muted">Events you have successfully purchased tickets for</p>
  </div>

  <% if (appliedEvents.length === 0) { %>

    <div class="card border-0 shadow-sm p-4 text-center mb-5">
      <p class="mb-0">You haven't purchased any tickets yet.</p>
    </div>

  <% } else { %>

    <div class="row g-4 mb-5">

      <% appliedEvents.forEach(event => { %>

        <div class="col-lg-6">

          <div class="card border-0 shadow-lg p-4 h-100 application-card">

            <div class="d-flex justify-content-between align-items-start mb-3">

              <div>
                <h5 class="fw-bold mb-1"><%= event.title %></h5>
                <p class="text-muted small mb-1">
                  <i class="bi bi-calendar-event"></i>
                  <%= new Date(event.date).toDateString() %>
                </p>
                <p class="text-muted small">
                  <i class="bi bi-geo-alt"></i>
                  <%= event.location %>
                </p>
              </div>

              <span class="badge bg-success">
                Ticket Purchased
              </span>

            </div>

            <hr>

            <!-- Reminder Form -->
            <form action="/reminders" method="POST">

              <input type="hidden" name="eventId" value="<%= event._id %>">

              <div class="mb-3">
                <label class="form-label small">Remind me:</label>
                <select name="reminderOption"
                        class="form-select reminder-select"
                        required>
                  <option value="10m">10 minutes before</option>
                  <option value="1h">1 hour before</option>
                  <option value="1d">1 day before</option>
                  <option value="custom">Custom time</option>
                </select>
              </div>

              <div class="mb-3 d-none custom-time-wrapper">
                <label class="form-label small">Choose custom time:</label>
                <input 
                  type="datetime-local" 
                  name="customReminderTime" 
                  class="form-control"
                >
              </div>

              <button type="submit" 
                      class="btn btn-primary btn-sm w-100">
                Set Reminder
              </button>

            </form>

          </div>

        </div>

      <% }) %>

    </div>

  <% } %>


  <!-- DISCOVER EVENTS -->

  <div class="mb-4">
    <h2 class="fw-bold">Discover Events</h2>
    <p class="text-muted">Explore the latest events available</p>
  </div>

  <div class="row g-4">

    <% availableEvents.forEach(event => { %>

      <div class="col-lg-4 col-md-6">

        <div class="card border-0 shadow-sm discover-card h-100">

          <img 
            src="<%= event.image ? event.image : '/images/default-event.jpeg' %>" 
            class="card-img-top"
            style="height:200px; object-fit:cover;"
            alt="<%= event.title %>"
          >

          <div class="card-body d-flex flex-column">

            <h5 class="fw-bold"><%= event.title %></h5>

            <p class="text-muted small mb-1">
              <i class="bi bi-calendar-event"></i>
              <%= new Date(event.date).toDateString() %>
            </p>

            <p class="text-muted small mb-3">
              <i class="bi bi-geo-alt"></i>
              <%= event.location %>
            </p>

            <a href="/events/<%= event.slug %>" 
              class="btn btn-primary btn-sm mt-auto">
              View & Apply
            </a>

          </div>
      </div>


      </div>

    <% }) %>

  </div>

</div>


<script>
  document.querySelectorAll(".reminder-select").forEach(select => {
    select.addEventListener("change", function () {
      const wrapper = this.closest("form").querySelector(".custom-time-wrapper")

      if (this.value === "custom") {
        wrapper.classList.remove("d-none")
      } else {
        wrapper.classList.add("d-none")
      }
    })
  })
</script>
